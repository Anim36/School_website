{% extends 'base.html' %}

{% block title %}Register - School Management System{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h4 class="card-title mb-0 text-center"><i class="fas fa-user-plus"></i> Create New Account</h4>
            </div>
            <div class="card-body">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}

                    {% if form.errors %}
                    <div class="alert alert-danger">
                        <strong>Please correct the following errors:</strong>
                        <ul class="mb-0">
                            {% for field in form %}
                                {% for error in field.errors %}
                                    <li>{{ field.label }}: {{ error }}</li>
                                {% endfor %}
                            {% endfor %}
                            {% for error in form.non_field_errors %}
                                <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}

                    <h5 class="mb-3 text-primary">Account Information</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="id_username" class="form-label">Username *</label>
                                {{ form.username }}
                                <div class="form-text">Required. 150 characters or fewer. Letters, digits and @/./+/-/_ only.</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="id_email" class="form-label">Email Address *</label>
                                {{ form.email }}
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="id_first_name" class="form-label">First Name *</label>
                                {{ form.first_name }}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="id_last_name" class="form-label">Last Name *</label>
                                {{ form.last_name }}
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="id_user_type" class="form-label">Account Type *</label>
                                {{ form.user_type }}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="id_phone" class="form-label">Phone Number</label>
                                {{ form.phone }}
                            </div>
                        </div>
                    </div>

                    <!-- Student Specific Fields -->
                    <div id="student-fields" style="display: {% if form.user_type.value == 'student' %}block{% else %}none{% endif %};">
                        <h5 class="mb-3 text-primary mt-4">Student Information</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="id_gender" class="form-label">Gender</label>
                                    {{ form.gender }}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="id_date_of_birth" class="form-label">Date of Birth</label>
                                    {{ form.date_of_birth }}
                                    <div class="form-text">{{ form.date_of_birth.help_text }}</div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="id_class_name" class="form-label">Class</label>
                                    {{ form.class_name }}
                                    <div class="form-text">{{ form.class_name.help_text }}</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="id_section" class="form-label">Section</label>
                                    {{ form.section }}
                                    <div class="form-text">{{ form.section.help_text }}</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="id_roll_number" class="form-label">Roll Number</label>
                                    {{ form.roll_number }}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="id_parent_name" class="form-label">Parent's Name</label>
                                    {{ form.parent_name }}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="id_parent_phone" class="form-label">Parent's Phone</label>
                                    {{ form.parent_phone }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <h5 class="mb-3 text-primary mt-4">Security Information</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="id_password1" class="form-label">Password *</label>
                                {{ form.password1 }}
                                <div class="form-text">
                                    <ul class="small">
                                        <li>Your password can't be too similar to your other personal information.</li>
                                        <li>Your password must contain at least 8 characters.</li>
                                        <li>Your password can't be a commonly used password.</li>
                                        <li>Your password can't be entirely numeric.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="id_password2" class="form-label">Confirm Password *</label>
                                {{ form.password2 }}
                                <div class="form-text">Enter the same password as before, for verification.</div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="agreeTerms" required>
                        <label class="form-check-label" for="agreeTerms">
                            I agree to the <a href="#" class="text-decoration-none">Terms and Conditions</a> and <a href="#" class="text-decoration-none">Privacy Policy</a>
                        </label>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-success btn-lg">Create Account</button>
                    </div>

                    <div class="text-center mt-3">
                        <p>Already have an account? <a href="{% url 'login' %}" class="text-decoration-none">Login here</a></p>
                    </div>
                </form>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-body text-center">
                <h6>Register As:</h6>
                <div class="btn-group w-100 mt-2">
                    <button type="button" class="btn btn-outline-primary user-type-btn" data-type="student">Student</button>
                    <button type="button" class="btn btn-outline-success user-type-btn" data-type="teacher">Teacher</button>
                    <!--<button type="button" class="btn btn-outline-info user-type-btn" data-type="parent">Parent</button>-->
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const userTypeSelect = document.getElementById('id_user_type');
    const studentFields = document.getElementById('student-fields');
    const userTypeBtns = document.querySelectorAll('.user-type-btn');

    function toggleFields() {
        const selectedType = userTypeSelect.value;
        studentFields.style.display = selectedType === 'student' ? 'block' : 'none';

        // Update button states
        userTypeBtns.forEach(btn => {
            if (btn.getAttribute('data-type') === selectedType) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });
    }

    userTypeSelect.addEventListener('change', toggleFields);

    userTypeBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const type = this.getAttribute('data-type');
            userTypeSelect.value = type;
            toggleFields();
        });
    });

    // Initial toggle
    toggleFields();
});
</script>

<style>
.user-type-btn.active {
    background-color: #0d6efd;
    color: white;
    border-color: #0d6efd;
}

.form-control, .form-select {
    border-radius: 8px;
    border: 2px solid #e9ecef;
    padding: 10px 15px;
}

.form-control:focus, .form-select:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
}
</style>
{% endblock %}